notifications:
  email: false
  irc:
    channels:
      - "irc.mysociety.org#sayit"
    use_notice: true

language: python

python:
  - "2.7"
  - "3.3"

services:
  - elasticsearch

env:
  - MODULES="Django>=1.4.2,<1.5 django-tastypie==0.9.16"
  - MODULES="Django>=1.5,<1.6 django-tastypie>=0.10.0"
  - MODULES="Django>=1.6,<1.7 django-tastypie>=0.10.0"
  - MODULES="Django>=1.7,<1.8" # TastyPie doesn't yet support 1.7
# - MODULES="git+https://github.com/django/django.git@master#egg=django"

# Django 1.4 did not support Python 3.
matrix:
  exclude:
    - python: "3.3"
      env: MODULES="Django>=1.4.2,<1.5 django-tastypie==0.9.16"

install:
  - wget -O sqlite.tar.gz --quiet http://www.sqlite.org/2014/sqlite-autoconf-3080600.tar.gz
  - tar xzf sqlite.tar.gz
  - (cd sqlite* && ./configure --prefix=/usr/local && make && sudo make install)
  - sudo apt-get update -qq
  - sudo apt-get install -qq ffmpeg libavcodec-extra-53 iceweasel xvfb
  - pip install $MODULES
  - pip install -e .[test]

before_script:
  - psql -c 'create database "sayit-example-project";' -U postgres
  - ./manage.py syncdb --noinput
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start

script:
  - SELENIUM_TESTS=1 ./manage.py test
